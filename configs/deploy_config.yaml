# 部署配置文件
# RV1126嵌入式部署配置

# 硬件平台配置
platform:
  name: rv1126                  # 目标平台
  npu_cores: 2                  # NPU核心数
  max_freq: 1.8GHz              # 最大频率

# 模型配置
model:
  # 输入配置
  input:
    name: images
    shape: [1, 3, 640, 640]     # [batch, channels, height, width]
    format: NCHW
    dtype: uint8
    mean: [0, 0, 0]             # 均值归一化
    std: [255, 255, 255]        # 标准差归一化
  
  # 输出配置
  outputs:
    - name: output0              # 大目标检测头
      shape: [1, 255, 80, 80]
    - name: output1              # 中目标检测头
      shape: [1, 255, 40, 40]
    - name: output2              # 小目标检测头
      shape: [1, 255, 20, 20]

# 量化配置
quantization:
  type: int8                    # 量化类型: fp16/int8/int4
  calibration:
    dataset: data/processed/flir/calibration/
    num_samples: 100            # 校准样本数
    batch_size: 1
  
  # 量化策略
  strategy:
    asymmetric: true            # 使用非对称量化
    per_channel: true           # 按通道量化
    
  # 精度优化
  optimization:
    # 对精度敏感层使用更高精度
    sensitive_layers: []
    hybrid_quantization: false

# RKNN转换配置
rknn:
  target_platform: rv1126
  optimization_level: 3         # 优化级别 1-3
  pre_compile: true             # 预编译优化
  
  # 性能模式
  performance:
    priority: high              # 优先级: high/normal/low
    core_mask: 3                # NPU核心掩码

# 后处理配置
postprocess:
  conf_threshold: 0.5           # 置信度阈值
  nms_threshold: 0.45           # NMS阈值
  max_detections: 100           # 最大检测数
  
  # Anchor配置
  anchors:
    - [[10, 13], [16, 30], [33, 23]]     # P3/8
    - [[30, 61], [62, 45], [59, 119]]    # P4/16
    - [[116, 90], [156, 198], [373, 326]] # P5/32
  
  # 类别配置
  classes: ['person', 'car', 'bicycle']
  num_classes: 3

# 视频流配置
video:
  source: /dev/video0           # 视频源
  width: 640                    # 视频宽度
  height: 480                   # 视频高度
  fps: 30                       # 帧率
  format: NV12                  # 像素格式

# 性能要求
performance:
  target_fps: 25                # 目标帧率
  max_latency_ms: 40            # 最大延迟(ms)
  cpu_limit: 60                 # CPU使用率限制(%)
  memory_limit_mb: 256          # 内存限制(MB)

# 日志配置
logging:
  level: INFO                   # 日志级别
  output: /var/log/infrared_tracker/
  max_size_mb: 100              # 最大日志大小
  
# 调试配置
debug:
  save_intermediate: false      # 保存中间结果
  profile: false                # 性能分析
  visualize: false              # 可视化输出
